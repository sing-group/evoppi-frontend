<!--
  ~  EvoPPI Frontend
  ~
  ~  Copyright (C) 2017-2018 - Noé Vázquez González,
  ~  Miguel Reboiro-Jato, Jorge Vieira, Hugo López-Fernández,
  ~  and Cristina Vieira.
  ~
  ~  This program is free software: you can redistribute it and/or modify
  ~  it under the terms of the GNU General Public License as published by
  ~  the Free Software Foundation, either version 3 of the License, or
  ~  (at your option) any later version.
  ~
  ~  This program is distributed in the hope that it will be useful,
  ~  but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  ~  GNU General Public License for more details.
  ~
  ~  You should have received a copy of the GNU General Public License
  ~  along with this program. If not, see <http://www.gnu.org/licenses/>.
  -->

<mat-card>
<form [formGroup]="formSameSpecies" (change)="onChangeForm()">
  <mat-form-field class="width-100">
    <mat-select placeholder="Species" (change)="onChangeSpecies($event.value)" formControlName="species">
      <mat-option *ngFor="let specie of species" [value]="specie">
        {{ specie.name }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field class="width-50">
    <mat-select placeholder="Reference Interactome" formControlName="interactomeA" (selectionChange)="onSelectInteractomeA($event.value)">
      <mat-option *ngFor="let interactome of interactomesA" [value]="interactome">
        {{ interactome.name }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field class="width-50 right">
    <mat-select placeholder="Target Interactome" formControlName="interactomeB" (selectionChange)="onSelectInteractomeB($event.value)">
      <mat-option *ngFor="let interactome of interactomesB" [value]="interactome">
        {{ interactome.name }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field class="width-100">
    <mat-label>Genes</mat-label>
    <input #searchInput type="search" matInput placeholder="Start typing something to search genes"
           formControlName="gene"
           autocomplete="off"
           [value]="genesInput" />
  </mat-form-field>
  <mat-accordion>
    <app-autocomplete *ngFor="let gene of genes" [title]="gene.geneId" [names]="gene.names" (radioSelected)="onGeneSelected($event)">
    </app-autocomplete>
  </mat-accordion>
  <mat-form-field class="width-25">
    <input type="number" matInput placeholder="Interaction level" formControlName="level" [(ngModel)]="level">
  </mat-form-field>
  <mat-slider thumbLabel tickInterval="1" [min]="1" [max]="3" [(ngModel)]="level" formControlName="level" class="width-75 right"></mat-slider>

  <button mat-raised-button color="primary" (click)="onCompare()" [disabled]="formSameSpecies.status === 'INVALID'">Compare</button>
  <a mat-raised-button color="primary" [href]="csvContent" [download]="csvName" *ngIf="csvContent !== ''">Export CSV</a>
  <!--a mat-raised-button color="primary" [href]="resultUrl + '/interactome/' + formSameSpecies.value.interactomeA.id + '/fasta'"
     [download]="formSameSpecies.value.interactomeA.name" *ngIf="csvContent !== ''">
    Export Fasta of {{formSameSpecies.value.interactomeA.name}}
  </a-->
  <a mat-raised-button color="primary" [href]="resultUrl + '/interactome/' + formSameSpecies.value.interactomeA.id + '/fasta'"
     target="_blank" *ngIf="csvContent !== ''">
    Export {{formSameSpecies.value.interactomeA.name}} FASTA
  </a>
  <a mat-raised-button color="primary" [href]="resultUrl + '/interactome/' + formSameSpecies.value.interactomeB.id + '/fasta'"
     target="_blank" *ngIf="csvContent !== ''">
    Export {{formSameSpecies.value.interactomeB.name}} FASTA
  </a>
  <a mat-raised-button color="primary" [href]="resultUrl + '/interactome/fasta'"
     target="_blank" *ngIf="csvContent !== ''">
    Export Single FASTA
  </a>
  <mat-card *ngIf="!hideTable">
    <mat-tab-group>
      <mat-tab label="Table view">
        <mat-table matSort #table [dataSource]="dataSource" class="table-same-species" appAfterViewInit (afterViewInit)="initTable()">
          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
          <ng-container matColumnDef="GeneA">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Gene A</mat-header-cell>
            <mat-cell *matCellDef="let row">
              <a (click)="onClickGene(row.geneA)" class="gene1">{{row.geneA}}</a>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="GeneB">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Gene B</mat-header-cell>
            <mat-cell *matCellDef="let row">
              <a (click)="onClickGene(row.geneB)" class="gene1">{{row.geneB}}</a>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="ReferenceInteractome">
            <mat-header-cell *matHeaderCellDef>{{referenceInteractome.name}}</mat-header-cell>
            <mat-cell *matCellDef="let row">
              <div *ngIf="row.interactomeDegrees[0].id === referenceInteractome.id">
                Degree {{row.interactomeDegrees[0].degree}}
              </div>
              <div *ngIf="row.interactomeDegrees.length === 2 && row.interactomeDegrees[1].id === referenceInteractome.id">
                Degree {{row.interactomeDegrees[1].degree}}
              </div>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="TargetInteractome">
            <mat-header-cell *matHeaderCellDef>{{targetInteractome.name}}</mat-header-cell>
            <mat-cell *matCellDef="let row">
              <div *ngIf="row.interactomeDegrees[0].id === targetInteractome.id">
                Degree {{row.interactomeDegrees[0].degree}}
              </div>
              <div *ngIf="row.interactomeDegrees.length === 2 && row.interactomeDegrees[1].id === targetInteractome.id">
                Degree {{row.interactomeDegrees[1].degree}}
              </div>
            </mat-cell>
          </ng-container>
        </mat-table>
        <mat-paginator #paginator
                       [pageSize]="10"
                       [pageSizeOptions]="[5, 10, 20]">
        </mat-paginator>
      </mat-tab>
      <mat-tab label="Graph view" *ngIf="nodes.length <= 100">
        <app-graph [nodes]="nodes" [links]="links" [graphWidth]="graphWidth" [graphHeight]="graphHeight"></app-graph>
        <app-legend-same-species [graphWidth]="graphWidth" [graphHeight]="graphHeight"></app-legend-same-species>
      </mat-tab>
      <mat-tab label="Graph view" *ngIf="nodes.length > 100">
        <mat-card><h2>Too much genes. Interactions graph is only shown for up to 100 genes.</h2></mat-card>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
</form>
</mat-card>
